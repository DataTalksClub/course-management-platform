{% extends 'cadmin/base.html' %}

{% block title %}Enrollments - {{ course.title }}{% endblock %}

{% block cadmin_content %}
<div class="container-fluid my-4">
  <nav aria-label="breadcrumb">
    <ol class="breadcrumb">
      <li class="breadcrumb-item"><a href="{% url 'cadmin_course_list' %}">Admin</a></li>
      <li class="breadcrumb-item"><a href="{% url 'cadmin_course' course.slug %}">{{ course.title }}</a></li>
      <li class="breadcrumb-item active">Enrollments</li>
    </ol>
  </nav>

  <h1>Enrollments for {{ course.title }}</h1>

  <div class="my-3">
    <a href="{% url 'cadmin_course' course.slug %}" class="btn btn-secondary">Back to Admin</a>
    <a href="{% url 'leaderboard' course.slug %}" class="btn btn-primary">View Leaderboard</a>
  </div>

  <div class="card my-4">
    <div class="card-header">
      <h3>All Enrollments ({{ enrollments.count }})</h3>
    </div>
    <div class="card-body">
      {% if enrollments %}
      <div class="table-responsive">
        <table class="table table-striped table-hover">
          <thead>
            <tr>
              <th>Position</th>
              <th>Student</th>
              <th>Display Name</th>
              <th>Total Score</th>
              <th>HW Submissions</th>
              <th>Project Submissions</th>
              <th>LiP Status</th>
              <th>Enrolled</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            {% for enrollment in enrollments %}
            <tr {% if enrollment.disable_learning_in_public %}class="table-warning"{% endif %}>
              <td>
                {% if enrollment.position_on_leaderboard %}
                  {{ enrollment.position_on_leaderboard }}
                {% else %}
                  -
                {% endif %}
              </td>
              <td>
                <strong>{{ enrollment.student.username }}</strong>
                {% if enrollment.student.email %}
                  <br><small class="text-muted">{{ enrollment.student.email }}</small>
                {% endif %}
              </td>
              <td>{{ enrollment.display_name }}</td>
              <td><strong>{{ enrollment.total_score }}</strong></td>
              <td>{{ enrollment.homework_count }}</td>
              <td>{{ enrollment.project_count }}</td>
              <td>
                {% if enrollment.disable_learning_in_public %}
                  <span class="badge badge-danger">DISABLED</span>
                {% else %}
                  <span class="badge badge-success">Enabled</span>
                {% endif %}
              </td>
              <td>{{ enrollment.enrollment_date|date:"Y-m-d" }}</td>
              <td>
                <a href="{% url 'cadmin_enrollment_edit' course.slug enrollment.id %}" class="btn btn-sm btn-primary">
                  <i class="fas fa-edit"></i> Manage
                </a>
                <a href="{% url 'leaderboard_score_breakdown' course_slug=course.slug enrollment_id=enrollment.id %}" class="btn btn-sm btn-info">
                  <i class="fas fa-chart-line"></i> Scores
                </a>
              </td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
      {% else %}
      <p>No enrollments found for this course.</p>
      {% endif %}
    </div>
  </div>

  <div class="alert alert-info">
    <strong>Note:</strong> Enrollments with <span class="badge badge-danger">DISABLED</span> LiP status have learning in public disabled.
    All their learning in public scores are set to zero and they cannot earn new learning in public points.
  </div>
</div>
{% endblock %}
