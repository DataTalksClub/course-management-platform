{% extends 'base.html' %}

{% load static %}

{% block content %}
  <h2>{{ homework.title }} for <a href="{% url 'course_detail' course.slug %}">{{ course.title }}</a></h2>
  <p>{{ homework.description }}</p>

  {% if messages %}
    {% for message in messages %}
      <div class="infobox {{ message.tags }}">
        <p>{{ message }}</p>
      </div>
    {% endfor %}
  {% endif %}

  {% if errors %}
    {% for error in errors %}
      <div class="infobox error">
        <p>{{ error }}</p>
      </div>
    {% endfor %}
  {% endif %}

  {% if homework.is_scored %}
    {% if submission %}
      <div class="infobox success">
        <p>This homework is already scored. Your score is {{ submission.total_score }}.</p>
      </div>
    {% else %}
      <div class="infobox warning">
        <p>This homework is already scored. You didn't submit your answers.</p>
      </div>
    {% endif %}
  {% endif %}

  <h3>Questions</h3>

  <form method="post">
    {% if is_authenticated %}
      {% csrf_token %}
    {% endif %}

    <!-- Display homework questions and submission form -->
    {% for question, answer in question_answers %}
      <div>
        <p>{{ question.text }}</p>

        {% if question.question_type == 'MC' %}
          <div>
            {% for option in answer.options %}
              <div class="{{ option.correctly_selected_class }}">
                <input
                  type="radio" 
                  name="answer_{{ question.id }}"
                  value="{{ option.value }}"
                  {% if option.is_selected %} checked {% endif %}
                  {% if homework.is_scored %} disabled {% endif %}
                />
                <label>{{ option.value }}</label>
              </div>
            {% endfor %}
          </div>

        {% elif question.question_type == 'CB' %}
          <div>
            {% for option in answer.options %}
              <div class="{{ option.correctly_selected_class }}">
                <input
                  type="checkbox"
                  name="answer_{{ question.id }}"
                  value="{{ option.value }}"
                  {% if option.is_selected %} checked {% endif %}
                  {% if homework.is_scored %} disabled {% endif %}
                />
                <label>{{ option.value }}</label>
              </div>
            {% endfor %}
          </div>

        {% elif question.question_type == 'FF' %}
          <div class="{{ answer.correctly_selected_class }}">
            <input
              type="text"
              name="answer_{{ question.id }}"
              value="{{ answer.text|default:'' }}"
              {% if homework.is_scored %} disabled {% endif %}
            />
          </div>
        {% endif %}
      </div>
    {% endfor %}

    {% if not homework.is_scored %}
      {% if is_authenticated %}
        <input type="submit" value="Save">
      {% else %}  
        <p>Please <a href="{% url 'login' %}">log in</a> to submit your answers.</p>
      {% endif %}
    {% endif %}
  </form>

  {% if submission %}
    <p>Last submission at: {{ submission.submitted_at|date:"F d, Y H:i" }}</p>
  {% endif %}

{% endblock %}